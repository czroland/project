<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition template="../WEB-INF/templates/template.xhtml">
    <ui:define name="title">
        Admin panel
    </ui:define>

    <ui:define name="body">

        <p:panel>

            <p:tabView id="tab">

                <p:tab title="#{msg['roles']}">
                    <h:form>
                        <h:panelGroup id="panel1">
                            <p:selectOneRadio id="roles" value="#{roleBean.userRole}" layout="responsive" columns="5">
                                <f:selectItems value="#{roleBean.roles}" var="userRole"
                                               itemLabel="#{msg['role.'+=userRole.name]}" itemValue="#{userRole.name}"/>
                            </p:selectOneRadio>

                            <p:dataTable id="users" var="user" value="#{userBean.users.source}"
                                         selection="#{userBean.users.target}" rowKey="#{user.id}"
                                         style="margin-bottom:0"
                                         rows="20"
                                         paginator="true"
                                         paginatorPosition="bottom"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="15, 20, 50">

                                <p:column selectionMode="multiple" style="width:36px;text-align:center"/>

                                <p:column headerText="#{msg['validator.uname']}" sortBy="#{user.name}">
                                    <h:outputText value="#{user.name}"/>
                                </p:column>

                                <p:column headerText="#{msg['admin.email']}" sortBy="#{user.email}">
                                    <h:outputText value="#{user.email}"/>
                                </p:column>

                                <p:column headerText="#{msg['roles']}">
                                    <h:dataTable id="asd" var="role" value="#{user.roles}">
                                        <p:column>
                                            <h:outputText id="as" value="#{msg['role.'+=role.name]}"/>
                                        </p:column>
                                    </h:dataTable>
                                </p:column>

                            </p:dataTable>

                            <p:commandButton id="add-role" value="#{msg['admin.role.add']}"
                                             style="margin-top:5px"
                                             update="panel1"
                                             action="#{roleMmt.addRole(userBean.users.target, roleBean.userRole)}"
                            />
                            <p:commandButton id="remove-role" value="#{msg['admin.role.remove']}"
                                             style="margin-top:5px"
                                             update="panel1"
                                             action="#{roleMmt.removeRole(userBean.users.target, roleBean.userRole)}"
                            />
                        </h:panelGroup>
                    </h:form>
                </p:tab>

                <p:tab title="#{msg['teachers']}">
                    <h:form>
                        <h:panelGroup id="panel2">

                            <p:panelGrid columns="2" layout="grid">

                                <h:outputLabel for="subject" value="#{msg['subject']}: *"/>
                                <p:selectOneMenu id="subject" required="true"
                                                 value="#{subjectBean.subject}" converter="subjectVoConverter"
                                                 requiredMessage="#{msg['subj.reg']}">
                                    <f:selectItem itemLabel="#{msg['reg.sel']}" itemValue=""/>
                                    <f:selectItems value="#{subjectBean.subjects}" var="subject"
                                                   itemLabel="#{subject.name}" itemValue="#{subject}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>

                            <p:dataTable id="teachers" var="teacher" value="#{teacherBean.teachers.source}"
                                         selection="#{teacherBean.teachers.target}" rowKey="#{teacher.id}"
                                         style="margin-bottom:0"
                                         rows="20"
                                         paginator="true"
                                         paginatorPosition="bottom"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="15, 20, 50">

                                <p:column selectionMode="multiple" style="width:36px;text-align:center"/>

                                <p:column headerText="#{msg['validator.uname']}" sortBy="#{teacher.user.name}">
                                    <h:outputText value="#{teacher.user.name}"/>
                                </p:column>

                                <p:column headerText="#{msg['fname']}" sortBy="#{teacher.user.firstName}">
                                    <h:outputText value="#{teacher.user.firstName}"/>
                                </p:column>

                                <p:column headerText="#{msg['lname']}" sortBy="#{teacher.user.lastName}">
                                    <h:outputText value="#{teacher.user.lastName}"/>
                                </p:column>

                                <p:column headerText="#{msg['subjects']}">
                                    <h:dataTable id="sub" var="subj" value="#{teacher.subject}">
                                        <p:column>
                                            <h:outputText id="ts" value="#{subj.name}"/>
                                        </p:column>
                                    </h:dataTable>
                                </p:column>

                            </p:dataTable>

                            <p:commandButton id="add-subject" value="#{msg['admin.role.add']}"
                                             style="margin-top:5px"
                                             update="panel2"
                                             action="#{subjectMmt.addSubject(teacherBean.teachers.target, subjectBean.subject)}"
                            />
                            <p:commandButton id="remove-subject" value="#{msg['admin.role.remove']}"
                                             style="margin-top:5px"
                                             update="panel2"
                                             action="#{subjectMmt.removeSubject(teacherBean.teachers.target, subjectBean.subject)}"
                            />

                        </h:panelGroup>
                    </h:form>
                </p:tab>

            </p:tabView>
        </p:panel>

    </ui:define>
</ui:composition>
</html>